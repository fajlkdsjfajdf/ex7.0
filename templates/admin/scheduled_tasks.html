{% extends "admin_base.html" %}

{% block title %}定时任务管理{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-clock"></i> 定时任务管理</h1>
    <p>管理系统中的定时任务，设置执行间隔和启用状态</p>
</div>

<div class="content-box">
    <div class="box-header">
        <h2><i class="fas fa-tasks"></i> 任务列表</h2>
        <button class="btn btn-primary" onclick="refreshTaskList()">
            <i class="fas fa-sync-alt"></i> 刷新
        </button>
    </div>

    <div id="taskList" class="task-list">
        <!-- 任务列表将通过JavaScript动态加载 -->
        <div class="loading">
            <i class="fas fa-spinner fa-spin"></i> 加载中...
        </div>
    </div>
</div>

<!-- 任务配置对话框 -->
<div id="taskConfigDialog" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="taskConfigDialogTitle">任务配置</h3>
            <button class="close-btn" onclick="closeTaskConfigDialog()">&times;</button>
        </div>
        <form id="taskConfigForm">
            <div class="modal-body">
                <input type="hidden" id="taskId">

                <div class="form-group">
                    <label>任务名称</label>
                    <input type="text" id="taskName" class="form-input" readonly>
                </div>

                <div class="form-group">
                    <label>任务描述</label>
                    <textarea id="taskDescription" class="form-input" readonly rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="taskEnabled">
                        <input type="checkbox" id="taskEnabled" name="enabled">
                        启用此任务
                    </label>
                </div>

                <div class="form-group">
                    <label for="taskInterval">执行间隔（小时）</label>
                    <input type="number" id="taskInterval" name="interval_hours" class="form-input" min="0.01" max="720" step="0.01" required>
                    <small class="text-muted">设置任务每隔多少小时执行一次（支持小数，如0.1表示6分钟）</small>
                </div>

                <div id="taskConfigParams">
                    <!-- 任务特定配置参数将动态加载 -->
                </div>

                <div class="form-group">
                    <label>最后执行时间</label>
                    <input type="text" id="taskLastRun" class="form-input" readonly>
                </div>

                <div class="form-group">
                    <label>下次执行时间</label>
                    <input type="text" id="taskNextRun" class="form-input" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeTaskConfigDialog()">取消</button>
                <button type="submit" class="btn btn-primary">保存配置</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='common/js/admin-scheduled-tasks.js') }}"></script>
{% endblock %}
