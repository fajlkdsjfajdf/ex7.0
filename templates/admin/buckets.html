{% extends "admin_base.html" %}

{% block title %}桶管理{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-buckets"></i> 桶管理</h1>
    <p class="page-subtitle">管理三桶系统的任务队列和容量配置</p>
    <p class="page-hint">三桶状态概览请查看 <a href="/admin" style="color: var(--accent-color);">仪表盘</a></p>
</div>

<!-- 容量配置 -->
<section class="dashboard-section">
    <h2 class="section-title">
        <i class="fas fa-sliders-h"></i> 容量配置
    </h2>
    <form id="bucketConfigForm" class="config-form">
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-bolt"></i> 高速桶容量
                </label>
                <input type="number" name="high_speed_max" class="form-input" value="100" min="1" max="10000">
                <span class="form-hint">高优先级任务队列的最大容量</span>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-snail"></i> 低速桶容量
                </label>
                <input type="number" name="low_speed_max" class="form-input" value="1000" min="1" max="100000">
                <span class="form-hint">低优先级批量任务队列的最大容量</span>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-check-circle"></i> 结果桶容量
                </label>
                <input type="number" name="result_max" class="form-input" value="10000" min="1" max="1000000">
                <span class="form-hint">已完成任务记录的最大容量</span>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> 保存配置
            </button>
            <button type="button" class="btn btn-secondary" onclick="loadBucketConfig()">
                <i class="fas fa-redo"></i> 重置
            </button>
        </div>
    </form>
</section>

<!-- 快速操作 -->
<section class="dashboard-section">
    <h2 class="section-title">
        <i class="fas fa-tools"></i> 快速操作
    </h2>
    <div class="quick-actions">
        <button class="btn btn-danger" onclick="clearBucket('high_speed')">
            <i class="fas fa-trash"></i> 清空高速桶
        </button>
        <button class="btn btn-danger" onclick="clearBucket('low_speed')">
            <i class="fas fa-trash"></i> 清空低速桶
        </button>
        <button class="btn btn-danger" onclick="clearBucket('result')">
            <i class="fas fa-trash"></i> 清空结果桶
        </button>
    </div>
</section>

<!-- 任务列表弹窗 -->
<div id="bucketTasksModal" class="modal">
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h2 id="bucketTasksModalTitle">桶任务列表</h2>
            <button class="modal-close" onclick="closeBucketTasksModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="tasks-table-container">
                <table class="tasks-table">
                    <thead>
                        <tr>
                            <th>任务ID</th>
                            <th>类型</th>
                            <th>优先级</th>
                            <th>站点</th>
                            <th>添加时间</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="bucketTasksTableBody">
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>暂无任务</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBucketTasksModal()">
                <i class="fas fa-times"></i> 关闭
            </button>
        </div>
    </div>
</div>

<!-- 任务详情弹窗 -->
<div id="taskDetailModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2>任务详情</h2>
            <button class="modal-close" onclick="closeTaskDetailModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div id="taskDetailContent">
                <!-- 详情内容将通过JavaScript填充 -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeTaskDetailModal()">
                <i class="fas fa-times"></i> 关闭
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/common/js/admin-buckets.js"></script>
{% endblock %}
